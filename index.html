<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CTB - Sistema de Gestão de Torneios</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="style.css">

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <img src="ctb.png" alt="CTB Logo" class="logo" onerror="this.style.display='none'; this.parentElement.insertAdjacentHTML('afterbegin', '<h1>CTB</h1>')">
            <h1>Clube dos Tenistas da Bahia</h1>
            <p>Sistema de Gestão de Torneios de Tênis de Mesa</p>
        </header>

        <nav>
            <button onclick="showPage('home')" class="nav-btn active">🏠 Início</button>
            <button onclick="showPage('cadastro')" class="nav-btn">📝 Cadastro</button>
            <button onclick="showPage('grupos')" class="nav-btn">👥 Grupos</button>
            <button onclick="showPage('jogos')" class="nav-btn">🏓 Jogos Grupo</button>
            <button onclick="showPage('eliminatorias')" class="nav-btn">🏆 Eliminatórias</button>
            <button onclick="showPage('ranking')" class="nav-btn">📊 Ranking</button>
            <button onclick="showPage('relatorios')" class="nav-btn">📄 Relatórios</button>
        </nav>

        <div class="content">
            <div id="home" class="page active">
                <div class="control-panel">
                    <h2>Controle do Torneio</h2>
                    <span class="status-badge status-inactive" id="tournamentStatus">Não Iniciado</span>
                    <div style="margin-top: 15px;">
                        <button class="btn btn-success" onclick="startTournament()">▶ Iniciar Torneio</button>
                        <button class="btn btn-danger" onclick="finalizeTournament()">⏹ Finalizar Torneio</button>
                        <button class="btn btn-warning" onclick="resetTournament()">🔄 Resetar Sistema</button>
                    </div>
                </div>
                <div class="alert alert-info">
                    <strong>📋 Como Usar:</strong>
                    <ol style="margin: 10px 0 0 20px;">
                         <li>Vá para <strong>📝 Cadastro</strong> e adicione os atletas. (Mínimo 3 por categoria).</li>
                         <li>Volte aqui e clique em <strong>▶ Iniciar Torneio</strong>.</li>
                         <li>Vá para <strong>👥 Grupos</strong>, selecione a categoria, gere os grupos e pode salvar o PDF da formação.</li>
                         <li>Vá para <strong>🏓 Jogos Grupo</strong>, selecione a categoria, pode gerar o PDF de súmulas em branco para impressão e registe os placares (set a set).</li>
                         <li>Clique em <strong>🏆 Finalizar Grupos e Gerar Eliminatórias</strong> após todos os jogos da fase de grupos serem salvos.</li>
                         <li>Vá para <strong>🏆 Eliminatórias</strong>, selecione a categoria, pode gerar o PDF de súmulas em branco para cada fase e registe os resultados (set a set).</li>
                         <li>O sistema avança os vencedores automaticamente.</li>
                         <li>Quando a final terminar, o ranking será calculado automaticamente.</li>
                         <li>Veja o resultado final em <strong>📊 Ranking</strong> e pode salvar o PDF do ranking.</li>
                         <li>Use a aba <strong>📄 Relatórios</strong> para exportar listas e resultados consolidados.</li>
                    </ol>
                </div>
                <h2>Categorias Cadastradas</h2>
                <div class="grid-3">
                    <div class="info-card"><h4>🏓 Sub 13</h4><p id="count-sub13">Atletas: 0</p></div>
                    <div class="info-card"><h4>🏓 Sub 15</h4><p id="count-sub15">Atletas: 0</p></div>
                    <div class="info-card"><h4>🏓 Sub 19</h4><p id="count-sub19">Atletas: 0</p></div>
                    <div class="info-card"><h4>🏓 Adulto A</h4><p id="count-adultoA">Atletas: 0</p></div>
                    <div class="info-card"><h4>🏓 Adulto B</h4><p id="count-adultoB">Atletas: 0</p></div>
                    <div class="info-card"><h4>🏓 Veterano</h4><p id="count-veterano">Atletas: 0</p></div>
                    <div class="info-card"><h4>🏓 Feminino</h4><p id="count-feminino">Atletas: 0</p></div>
                </div>
            </div>

            <div id="cadastro" class="page">
                <h2>Cadastro de Atletas</h2>
                <div class="alert alert-info">Cadastre atletas com nome e ranking inicial (1 = melhor posição)</div>
                <div class="form-group"><label>Nome do Atleta *</label><input type="text" id="athleteName" placeholder="Digite o nome completo"></div>
                <div class="form-group"><label>Ranking Inicial * (1, 2, 3...)</label><input type="number" id="athleteRanking" placeholder="Digite o ranking (ex: 1)" min="1" value="1"></div>
                <div class="form-group">
                    <label>Categoria *</label>
                    <select id="athleteCategory">
                        <option value="sub13">Sub 13</option><option value="sub15">Sub 15</option><option value="sub19">Sub 19</option>
                        <option value="adultoA">Adulto A</option><option value="adultoB">Adulto B</option><option value="veterano">Veterano</option>
                        <option value="feminino">Feminino</option>
                    </select>
                </div>
                <button class="btn btn-success" onclick="addAthlete()">✓ Cadastrar Atleta</button>
                <hr style="margin: 30px 0;">
                <h2>Atletas Cadastrados</h2>
                <div class="alert alert-warning" id="no-athletes-warning">Nenhum atleta cadastrado ainda.</div>
                <table id="athletes-table" style="display:none;">
                    <thead><tr><th>Nome</th><th>Categoria</th><th>Ranking</th><th>Ações</th></tr></thead>
                    <tbody id="athletes-table-body"></tbody>
                </table>
            </div>

            <div id="grupos" class="page">
                <h2>Gerenciamento de Grupos</h2>
                <div class="alert alert-info">Selecione a categoria e clique em "Gerar Grupos" para aplicar o "Snake System" dinâmico.</div>
                <div class="form-group" style="max-width: 500px;">
                    <label>Selecione a Categoria:</label>
                    <select id="group-category-select" onchange="document.getElementById('save-groups-pdf-btn').style.display = 'none'; document.getElementById('group-display-area').innerHTML=''; document.getElementById('group-info-area').innerHTML='';">
                        <option value="">-- Nenhuma categoria com atletas --</option>
                    </select>
                </div>
                <button class="btn btn-success" onclick="generateGroups()">👥 Gerar Grupos</button>
                <button id="save-groups-pdf-btn" class="btn btn-info" onclick="generateGroupsReport(document.getElementById('group-category-select').value)" style="display: none;">📄 Salvar Grupos (PDF)</button>
                <hr style="margin: 30px 0;">
                <div id="group-info-area"></div>
                <div id="group-display-area" class="group-container"></div>
            </div>

            <div id="jogos" class="page">
                <h2>Resultados dos Jogos (Fase de Grupos)</h2>
                <div class="alert alert-info">Selecione a categoria para ver os jogos, gerar súmulas em branco para impressão, e registar os placares set a set. A classificação é atualizada automaticamente.</div>
                <div class="form-group" style="max-width: 500px;">
                    <label>Selecione a Categoria:</label>
                    <select id="games-category-select" onchange="renderGroupMatchesAndStandings()">
                        <option value="">-- Nenhum grupo gerado --</option>
                    </select>
                </div>
                <button class="btn btn-info" id="generate-scoresheets-btn" onclick="generateBatchScoresheets(document.getElementById('games-category-select').value, 'group')" style="display: none;">📄 Gerar Súmulas em Lote (PDF)</button>
                <button class="btn btn-success" id="finalize-groups-btn" onclick="finalizeGroupsAndGenerateKnockout()" style="display: none;">🏆 Finalizar Grupos e Gerar Eliminatórias</button>
                <hr style="margin: 30px 0;">
                <h3>Classificação dos Grupos</h3>
                <div id="games-standings-area" class="group-container"></div>
                <hr style="margin: 30px 0;">
                <h3>Jogos</h3>
                <div id="games-display-area"></div>
            </div>

            <div id="eliminatorias" class="page">
                <h2>Fase Eliminatória (Mata-Mata)</h2>
                <div class="form-group" style="max-width: 500px;">
                    <label>Selecione a Categoria:</label>
                    <select id="knockout-category-select" onchange="renderKnockoutBracket()">
                        <option value="">-- Nenhuma eliminatória gerada --</option>
                    </select>
                </div>
                <hr style="margin: 30px 0;">
                <div id="knockout-info-area"></div>
                <div class="knockout-bracket" id="knockout-display-area"></div>
            </div>

            <div id="ranking" class="page">
                <h2>Ranking Final</h2>
                <div class="form-group" style="max-width: 500px;">
                    <label>Selecione a Categoria:</label>
                    <select id="ranking-category-select" onchange="renderRanking()">
                        <option value="">-- Nenhum torneio finalizado --</option>
                    </select>
                </div>
                <button class="btn btn-info" id="save-ranking-pdf-btn" onclick="generateRankingReport(document.getElementById('ranking-category-select').value)" style="display: none;">📄 Salvar Ranking (PDF)</button>
                <hr style="margin: 30px 0;">
                <div id="ranking-display-area"></div>
            </div>

            <div id="relatorios" class="page">
                <h2>Relatórios Consolidados</h2>
                <div class="alert alert-info">Exporte os dados de **todas** as categorias do torneio em formato PDF. Os PDFs de Súmula em branco são gerados nas páginas de Jogos e Eliminatórias.</div>
                <h4>Listas e Estruturas</h4>
                <button class="btn btn-info" onclick="generateAthleteReport()">📄 Atletas Inscritos (Geral)</button>
                <button class="btn btn-info" onclick="generateGroupsReport()">👥 Grupos Formados (Geral)</button>
                <h4>Resultados e Jogos</h4>
                 <button class="btn btn-info" onclick="generateGroupMatchesReport()">🏓 Jogos dos Grupos (Geral)</button>
                 <button class="btn btn-info" onclick="generateKnockoutReport()">🏆 Jogos Eliminatórios (Geral)</button>
                 <button class="btn btn-info" onclick="generateResultsReport()">📋 Classificação Final dos Grupos (Geral)</button>
                 <button class="btn btn-info" onclick="generateOverallResultsReport()">🏅 Resultados Gerais (Todas as Partidas)</button>
            </div>

        </div> </div> <script src="app.js"></script>
</body>
</html>
